# .github/workflows/reminder.yml
name: Commit Reminder & README Bot

on:
  schedule:
    - cron: '50 20 * * *'  # 11:50 PM EAT = 8:50 PM UTC
  workflow_dispatch:

jobs:
  check-commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Check for commits today
        id: commitcheck
        run: |
          TODAY=$(date -u +%F)
          COMMITS=$(git log --since=$TODAY --oneline | wc -l)
          echo "Today's commits: $COMMITS"
          echo "commits=$COMMITS" >> $GITHUB_OUTPUT

      - name: Send WhatsApp reminder if no commits
        if: steps.commitcheck.outputs.commits == '0'
        run: |
          curl -X POST https://api.twilio.com/2010-04-01/Accounts/${{ secrets.TWILIO_ACCOUNT_SID }}/Messages.json \
          --data-urlencode "To=whatsapp:+254768133220" \
          --data-urlencode "From=whatsapp:+14155238886" \
          --data-urlencode "Body=🚨 No commits today! Push something or README will change in 10 minutes." \
          -u "${{ secrets.TWILIO_ACCOUNT_SID }}:${{ secrets.TWILIO_AUTH_TOKEN }}"

      - name: Force README push if no commit
        if: steps.commitcheck.outputs.commits == '0'
        run: |
          echo "🔁 Automated reminder at $(date)" >> README.md
          git config user.email "bot@github.com"
          git config user.name "ReminderBot"
          git add README.md
          git commit -m "🤖 Auto update README: No commit on $(date -I)"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
