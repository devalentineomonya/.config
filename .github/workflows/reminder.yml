name: Commit Reminder & Log Bot

on:
  schedule:
    - cron: '50 20 * * *'  # 11:50 PM EAT (UTC+3)
  workflow_dispatch:

jobs:
  check-commit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Check for commits today (UTC)
        id: commitcheck
        run: |
          TODAY=$(date -u +%F)
          COMMITS=$(git log --since=$TODAY --oneline | wc -l)
          echo "Today's commits: $COMMITS"
          echo "commits=$COMMITS" >> $GITHUB_OUTPUT

  
      - name: Debug Token Info (Safe)
        run: |
          echo "Repo: ${{ github.repository }}"
          echo "Actor: ${{ github.actor }}"
          echo "Token exists: ${{ secrets.PAT != '' }}"


      - name: Commit and Push Log
        if: steps.commitcheck.outputs.commits == '0'
        run: |
          mkdir -p .log
          echo "ğŸ“… No commit on $(date -u) â€” reminder triggered." >> .log/commit-check.log
          git config user.email "bot@github.com"
          git config user.name "ReminderBot"
          git add .log/commit-check.log
          git commit -m "ğŸ“ Log: No commit on $(date -I)"
      
          # ğŸ”¥ Set the remote with PAT to override github-actions[bot]
          git remote remove origin
          git remote add origin https://x-access-token:${{ secrets.PAT }}@github.com/${{ github.repository }}
      
          # âœ… Push with PAT-authenticated remote
          git push origin HEAD:main

